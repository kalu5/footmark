# react-mobile-web

## ä¸€ã€é¡¹ç›®æ­å»º

### åŸºç¡€é¡¹ç›®æ­å»º vite + ts + react 

#### åˆå§‹é¡¹ç›®

``` bash
pnpm init -y
```
#### å®‰è£…ä¾èµ–

1. devDependencies:
``` bash
pnpm add -D @vitejs/plugin-react-swc typescript vite @types/react @types/react-dom
```

2. Dependencies:

``` bash
pnpm add react react-dom
```

packages.json:

``` json
{
  "name": "inspector-mobile-web",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "dev": "vite"
  },
  "type": "module",
  "keywords": [],
  "author": "",
  "license": "ISC",
  "packageManager": "pnpm@10.20.0",
  "devDependencies": {
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react-swc": "^4.2.2",
    "typescript": "^5.9.3",
    "vite": "^7.3.0"
  },
  "dependencies": {
    "react": "^19.2.3",
    "react-dom": "^19.2.3"
  }
}
```

#### é…ç½®tsconfig

tsconfig.base.json:
``` json
{
  "compilerOptions": {
    "target": "esnext",
    "module": "esnext",
    "esModuleInterop": true,      // å…¼å®¹CommonJS/ESæ¨¡å—å¯¼å…¥
    "skipLibCheck": true,         // è·³è¿‡ç¬¬ä¸‰æ–¹åº“ç±»å‹æ£€æŸ¥ï¼ˆæå‡ç¼–è¯‘é€Ÿåº¦ï¼‰
    "forceConsistentCasingInFileNames": true, // å¼ºåˆ¶æ–‡ä»¶åå¤§å°å†™ä¸€è‡´

    /* Bundler mode */
    "allowImportingTsExtensions": true, // å…è®¸ TypeScript æ–‡ä»¶ä½¿ç”¨ç‰¹å®šäº TypeScript çš„æ‰©å±•åï¼ˆå¦‚ .tsã€.mts æˆ– .tsxï¼‰ç›¸äº’å¯¼å…¥
    "verbatimModuleSyntax": true, // ä»»ä½•æ²¡æœ‰ type ä¿®é¥°ç¬¦çš„å¯¼å…¥æˆ–å¯¼å‡ºéƒ½ä¼šä¿ç•™ã€‚ä»»ä½•ä½¿ç”¨äº† type ä¿®é¥°ç¬¦çš„éƒ½ä¼šè¢«å®Œå…¨ç§»é™¤ã€‚
    "moduleDetection": "force", // æ§åˆ¶ TypeScript å¦‚ä½•ç¡®å®šä¸€ä¸ªæ–‡ä»¶æ˜¯è„šæœ¬è¿˜æ˜¯æ¨¡å—; ç¡®ä¿æ¯ä¸ªéå£°æ˜æ–‡ä»¶éƒ½è¢«è§†ä¸ºæ¨¡å—ã€‚
    "noEmit": true, // ä¸ç”Ÿæˆè¾“å‡ºæ–‡ä»¶ï¼Œä»…æ£€æŸ¥ç±»å‹

    /* Linting */
    "strict": true,               // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥ï¼ˆå¿…é€‰ï¼ï¼‰
    "noUnusedLocals": true, // æŠ¥é”™å®šä¹‰äº†å˜é‡ä½†æœªä½¿ç”¨
    "noUnusedParameters": true, // æŠ¥é”™å‡½æ•°å‚æ•°å®šä¹‰ä½†æœªä½¿ç”¨
    "erasableSyntaxOnly": true, // æ ‡å¿—ä¼šä½¿ TypeScript åœ¨é‡åˆ°å¤§å¤šæ•°å…·æœ‰è¿è¡Œæ—¶è¡Œä¸ºçš„ TypeScript ç‰¹å®šç»“æ„æ—¶æŠ¥é”™
    "noFallthroughCasesInSwitch": true, // æŠ¥é”™ switch è¯­å¥ä¸­ç¼ºå°‘ break æˆ– continue è¯­å¥
    "noUncheckedSideEffectImports": true // æŠ¥é”™å¯¼å…¥çš„æ¨¡å—å¯èƒ½æœ‰å‰¯ä½œç”¨
  }
}
```

tsconfig.app.json:
``` json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "lib": ["esnext", "DOM", "DOM.Iterable"],

    // bundler ç›¸å…³
    "jsx": "react-jsx", // react å¯é€‰
    "moduleResolution": "bundler", // é…åˆæ‰“åŒ…å·¥å…·
    "isolatedModules": true, // æ¯ä¸ªæ–‡ä»¶ä½œä¸ºå•ç‹¬æ¨¡å—ï¼Œé˜²æ­¢è·¨æ–‡ä»¶å¼•ç”¨é—®é¢˜
  },
  "include": [
    "src"
  ]
}
```

tsconfig.node.json:
``` json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "lib": ["esnext"],
    "module": "nodenext",
    "allowSyntheticDefaultImports": true, // å…¼å®¹æ— é»˜è®¤å¯¼å‡ºçš„åº“
  },
  "include": ["vite.config.ts"]
}
```

tsconfig.json:
``` json
{
  "files": [], // ç©ºæ•°ç»„ï¼Œå› ä¸ºå¼•ç”¨äº†å…¶ä»–æ–‡ä»¶
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.node.json"
    }
  ]
}
```

#### é…ç½®vite

vite.config.ts
``` ts
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [
    react()
  ]
})
```

**æ³¨æ„ï¼š**
package.jsonä¸­é…ç½®typeä¸ºmodule

#### æ–°å»ºindex.html
``` html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!-- ç¦æ­¢ç”¨æˆ·ç¼©æ”¾ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Document</title>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="./src/main.tsx"></script>
</body>
</html>
```

#### æ–°å»ºsrc/main.tsx
``` tsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import App from './App'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>
)
```
#### æ–°å»ºsrc/App.tsx
``` tsx
import { FC } from 'react'

const App: FC = () => {
  return (
    <div>
      <h1>Hello, React!</h1>
    </div>
  )
}

export default App
```

#### é…ç½®å¯åŠ¨å‘½ä»¤

``` json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview"
  }
}
```

### é¡¹ç›®è§„èŒƒ

#### ç›®å½•ç»“æ„

```
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ apis
â”‚   â”œâ”€â”€ assets
â”‚   â”œâ”€â”€ components
â”‚   â”œâ”€â”€ hooks
â”‚   â”œâ”€â”€ router
â”‚   â”œâ”€â”€ store
â”‚   â”œâ”€â”€ typings
â”‚   â”œâ”€â”€ utils
â”‚   â”œâ”€â”€ views
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ main.tsx
â”‚   â”œâ”€â”€ styles.d.ts
â”‚   â”œâ”€â”€ vite.d.ts
â”œâ”€â”€ .env
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .prettierignore
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ eslint.config.ts
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ postcss.config.js
â”œâ”€â”€ README.md
â”œâ”€â”€ tsconfig.base.json
â”œâ”€â”€ tsconfig.app.json
â”œâ”€â”€ tsconfig.node.json
â”œâ”€â”€ vite.config.ts
```

#### ä»£ç æ£€æŸ¥

[ESLint](https://eslint.org/) æ˜¯ä¸€ä¸ªä»£ç æ£€æŸ¥å·¥å…·ï¼Œå®ƒå¯ä»¥æ£€æŸ¥ä½ çš„ä»£ç æ˜¯å¦ç¬¦åˆä¸€è‡´çš„æ ·å¼ã€‚

``` bash
pnpm create @eslint/config@latest
# æŒ‰ç…§æç¤ºé…ç½®å’Œå®‰è£…ä¾èµ–
pnpm add -D eslint @eslint/js globals typescript-eslint eslint-plugin-react @eslint/css jiti
# å…¶ä»–æ’ä»¶é…ç½®
pnpm add -D eslint-plugin-react-hooks eslint-plugin-react-refresh eslint-plugin-import
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ eslint-plugin-import**
ä¸ºä»€ä¹ˆè¦ä½¿ç”¨eslint-plugin-importï¼Ÿäº”å¤§æ ¸å¿ƒç†ç”±

1. é˜²æ­¢æ¨¡å—è·¯å¾„é”™è¯¯ï¼ˆé¿å…è¿è¡Œæ—¶å´©æºƒï¼‰
é—®é¢˜ï¼šæ‰‹åŠ¨è¾“å…¥å¯¼å…¥è·¯å¾„æ—¶ï¼Œå®¹æ˜“æ‹¼å†™é”™è¯¯æˆ–å¼•ç”¨ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼ˆå¦‚import { Button } from './Buton'ï¼‰ï¼Œå¯¼è‡´è¿è¡Œæ—¶Module not foundé”™è¯¯ã€‚
æ’ä»¶è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡è§„åˆ™å¦‚import/no-unresolvedï¼Œé™æ€åˆ†æè·¯å¾„æœ‰æ•ˆæ€§ï¼Œåœ¨ç¼–ç é˜¶æ®µå³æ—¶æŠ¥é”™ã€‚
æ”¶ç›Šï¼šå‡å°‘80%çš„è·¯å¾„ç›¸å…³bugï¼ŒèŠ‚çœè°ƒè¯•æ—¶é—´ã€‚ğŸ’¡

2. æ¶ˆé™¤æ— æ•ˆä»£ç ï¼ˆä¼˜åŒ–åŒ…ä½“ç§¯ï¼‰
é—®é¢˜ï¼šæœªä½¿ç”¨çš„å¯¼å…¥ï¼ˆå¦‚import lodash from 'lodash'ä½†æœªè°ƒç”¨ï¼‰ä¼šå¢åŠ æ‰“åŒ…ä½“ç§¯ï¼Œå½±å“åº”ç”¨æ€§èƒ½ã€‚
æ’ä»¶è§£å†³æ–¹æ¡ˆï¼šè§„åˆ™import/no-unused-moduleså’Œimport/no-unused-importsè‡ªåŠ¨æ£€æµ‹å†—ä½™å¯¼å…¥ã€‚
æ”¶ç›Šï¼šåœ¨Viteç­‰æ„å»ºå·¥å…·ä¸­ï¼Œå¯å‡å°‘10-30%çš„äº§ç‰©ä½“ç§¯ï¼Œæå‡åŠ è½½é€Ÿåº¦ã€‚

3. é˜»æ­¢ä¾èµ–é™·é˜±ï¼ˆç¡®ä¿é¡¹ç›®ç¨³å®šæ€§ï¼‰
é—®é¢˜ï¼šå¾ªç¯ä¾èµ–ï¼ˆAå¯¼å…¥Bï¼ŒBåˆå¯¼å…¥Aï¼‰æˆ–ç¼ºå¤±ä¾èµ–ï¼ˆå¦‚æœªå®‰è£…lodashå´å°è¯•å¯¼å…¥ï¼‰ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚
æ’ä»¶è§£å†³æ–¹æ¡ˆï¼š
import/no-cycleï¼šç¦æ­¢å¾ªç¯ä¾èµ–ã€‚
import/no-extraneous-dependenciesï¼šæ£€æŸ¥package.jsonæ˜¯å¦å£°æ˜äº†ä¾èµ–ã€‚
æ”¶ç›Šï¼šé¿å…æ„å»ºå¤±è´¥æˆ–è¿è¡Œæ—¶å´©æºƒï¼Œå°¤å…¶é€‚åˆMonorepoé¡¹ç›®ã€‚

4. ç»Ÿä¸€ä»£ç é£æ ¼ï¼ˆæå‡å›¢é˜Ÿåä½œæ•ˆç‡ï¼‰
é—®é¢˜ï¼šå›¢é˜Ÿæˆå‘˜å¯èƒ½æ··ç”¨ä¸åŒå¯¼å…¥é£æ ¼ï¼ˆå¦‚import * as React from 'react' vs. import React from 'react'ï¼‰ï¼Œé™ä½å¯è¯»æ€§ã€‚
æ’ä»¶è§£å†³æ–¹æ¡ˆï¼šè§„åˆ™å¦‚ï¼š
import/orderï¼šå¼ºåˆ¶å¯¼å…¥åˆ†ç»„æ’åºï¼ˆä¾‹å¦‚å…ˆç¬¬ä¸‰æ–¹åº“ï¼Œåæœ¬åœ°æ–‡ä»¶ï¼‰ã€‚
import/prefer-default-exportï¼šæ¨èé»˜è®¤å¯¼å‡ºä»¥ç®€åŒ–ä»£ç ã€‚
æ”¶ç›Šï¼šé€šè¿‡è‡ªåŠ¨åŒ–è§„èŒƒï¼Œå‡å°‘ä»£ç å®¡æŸ¥å†²çªï¼Œæé«˜åä½œæµç•…åº¦ã€‚

5. å¢å¼ºç±»å‹å®‰å…¨ï¼ˆTypeScriptæ”¯æŒï¼‰
é—®é¢˜ï¼šåœ¨TypeScripté¡¹ç›®ä¸­ï¼Œé”™è¯¯çš„å¯¼å…¥ç±»å‹ï¼ˆå¦‚import { User } from './types'ä½†Useræœªå®šä¹‰ï¼‰å¯èƒ½è¢«ç¼–è¯‘å™¨å¿½ç•¥ã€‚
æ’ä»¶è§£å†³æ–¹æ¡ˆï¼šè§„åˆ™import/namedå’Œimport/defaultä¸TypeScripté›†æˆï¼Œæä¾›é¢å¤–é™æ€æ£€æŸ¥ã€‚
æ”¶ç›Šï¼šä½œä¸ºTSLintæˆ–@typescript-eslintçš„è¡¥å……ï¼Œæå‰æ•è·ç±»å‹é”™è¯¯ã€‚

**å¼•å…¥é¡ºåº**
åˆ†ç»„ç±»å‹ å«ä¹‰	å®é™…ç¤ºä¾‹æ’åºä¼˜å…ˆçº§
builtin  Node.jså†…ç½®æ¨¡å—	import path from 'path';	1 (æœ€é«˜)
external	å¤–éƒ¨ä¾èµ–ï¼ˆnode_modulesä¸­çš„åŒ…ï¼‰	import React from 'react';	2
internal	é¡¹ç›®å†…éƒ¨æ¨¡å—ï¼ˆåˆ«åæˆ–ç›¸å¯¹è·¯å¾„ï¼‰	import api from '@/utils/api';	3
parent	çˆ¶ç›®å½•ä¸­çš„æ¨¡å—ï¼ˆ../ï¼‰	import config from '../config';	4
sibling	åŒçº§ç›®å½•ä¸­çš„æ¨¡å—ï¼ˆ./ï¼‰	import Button from './Button';	5 (æœ€ä½)

**æ³¨æ„ï¼š**
lintæ—¶å‘Šè­¦ï¼š Warning: React version not specified in eslint-plugin-react settings. See https://github.com/jsx-eslint/eslint-plugin-react#configuration .

è§£å†³æ–¹å¼ï¼šéœ€è¦åœ¨ESLinté…ç½®ä¸­æ˜ç¡®æŒ‡å®šReactç‰ˆæœ¬ï¼Œä»¥é¿å…è§„åˆ™è¯¯åˆ¤

``` ts
settings: {
  react: {
    version: "detect", // è‡ªåŠ¨ä»node_modules/reactè¯»å–ç‰ˆæœ¬
  },
},
```

eslint.config.ts
``` ts
import js from "@eslint/js";
import globals from "globals";
// eslint-disable-next-line import/no-unresolved
import tseslint from "typescript-eslint";
import pluginReact from "eslint-plugin-react";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import importPlugin from "eslint-plugin-import";
// eslint-disable-next-line import/no-unresolved
import { defineConfig, globalIgnores } from "eslint/config";

export default defineConfig([
  // å…¨å±€å¿½ç•¥ dist ç›®å½•
  globalIgnores(["dist"]),
  {
    files: ["**/*.{js,mjs,cjs,ts,mts,cts,jsx,tsx}"],
    plugins: { js },
    extends: ["js/recommended"],
    languageOptions: { globals: globals.browser },
  },
  importPlugin.flatConfigs.recommended,
  importPlugin.flatConfigs.typescript,
  tseslint.configs.recommended,
  pluginReact.configs.flat.recommended,
  reactHooks.configs.flat.recommended,
  reactRefresh.configs.vite,
  // base
  {
    rules: {
      "no-console": "error",
      "no-debugger": "error",
      indent: ["error", 2],
      '@typescript-eslint/no-unused-vars': ['error', {
        caughtErrorsIgnorePattern: '^_', // å¿½ç•¥ä»¥ _ å¼€å¤´çš„å˜é‡å
      }], // ç¦æ­¢å®šä¹‰æœªä½¿ç”¨çš„å˜é‡
    },
  },
  // react
  {
    rules: {
      // åŸºç¡€Reactè§„èŒƒ (eslint-plugin-react)
      "react/react-in-jsx-scope": "off", // React 17+å¯å…³é—­
      "react/jsx-uses-vars": "error",
      "react/no-deprecated": "warn", // æ£€æµ‹åºŸå¼ƒAPIï¼ˆéœ€ç‰ˆæœ¬æ”¯æŒï¼‰

      // Hooksè§„èŒƒ (eslint-plugin-react-hooks)
      "react-hooks/rules-of-hooks": "error", // å¿…é¡»è®¾ä¸ºerror
      "react-hooks/exhaustive-deps": "warn", // ä¾èµ–æ£€æŸ¥è®¾ä¸ºwarn

      // çƒ­æ›´æ–°å…¼å®¹ (eslint-plugin-react-refresh)
      "react-refresh/only-export-components": [
        "warn",
        { allowConstantExport: true }, // å…è®¸å¯¼å‡ºå¸¸é‡
      ],
    },
    settings: {
      react: {
        version: "detect", // è‡ªåŠ¨ä»node_modules/reactè¯»å–ç‰ˆæœ¬
      },
    },
  },
  // import
  {
    rules: {
      // å…³é”®è§„åˆ™å¯ç”¨
      "import/no-unresolved": "error", // è·¯å¾„å¿…é¡»æœ‰æ•ˆ
      "import/no-unused-modules": "warn", // æœªä½¿ç”¨æ¨¡å—è­¦å‘Š
      "import/no-cycle": "error", // ç¦æ­¢å¾ªç¯ä¾èµ–
      "import/order": [
        // å¯¼å…¥æ’åº
        "error",
        {
          groups: ["builtin", "external", "internal", "parent", "sibling"],
          "newlines-between": "always",
        },
      ],
    },
    settings: {
      "import/resolver": {
        node: {
          extensions: [".js", ".jsx", ".ts", ".tsx"], // æ”¯æŒViteæ–‡ä»¶ç±»å‹
        },
      },
    },
  },
]);

```

#### ä»£ç æ ¼å¼åŒ–ï¼ˆPrettierï¼‰

[Prettier](https://prettier.io/) æ˜¯ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å·¥å…·ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æ ¼å¼åŒ–ä½ çš„ä»£ç ï¼Œä½¿å®ƒç¬¦åˆä¸€è‡´çš„æ ·å¼ã€‚

``` bash
pnpm add --save-dev --save-exact prettier

# é…ç½®Prettierè§„åˆ™
node --eval "fs.writeFileSync('.prettierrc','{}\n')"
# é…ç½®Prettierå¿½ç•¥æ–‡ä»¶
node --eval "fs.writeFileSync('.prettierignore','# Ignore artifacts:\nbuild\ncoverage\n')"

# ä½¿ç”¨eslintéœ€è¦å®‰è£…eslint-config-prettier
pnpm add -D eslint-config-prettier
```
1. é…ç½®eslint-config-prettier
``` ts
import eslintConfigPrettier from "eslint-config-prettier/flat";
export default defineConfig([
  eslintConfigPrettier,
]);
```

2. é…ç½®.prettierrc
``` json
{
  "singleQuote": true
}
```

3. é…ç½®script
``` json
{
  "scripts": {
    "lint": "eslint . --ext .js,.jsx,.ts,.tsx",
    "format": "prettier --write \"src/**/*.{js,jsx,ts,tsx,css,md}\""
  }
}
```

#### æš‚å­˜åŒºæäº¤å‰æ£€æŸ¥å’Œæ ¼å¼åŒ–ä»£ç 

æœ¬é¡¹ç›®ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼

1. lint-staged / husky
å®‰è£…lint-stagedå’Œhuskyå¹¶é…ç½®æäº¤æ£€æŸ¥
``` bash
npx mrm@2 lint-staged
```

2. git-simple-hooks

``` bash
pnpm add --save-dev simple-git-hooks pretty-quick
echo '{\n  "pre-commit": "pnpm pretty-quick --staged"\n}\n' > .simple-git-hooks.json
pnpm simple-git-hooks
```

#### æäº¤æ¶ˆæ¯æ£€æŸ¥

[Commitlint](https://commitlint.js.org/) æ˜¯ä¸€ä¸ªæäº¤æ¶ˆæ¯æ£€æŸ¥å·¥å…·ï¼Œå®ƒå¯ä»¥æ£€æŸ¥ä½ çš„æäº¤æ¶ˆæ¯æ˜¯å¦ç¬¦åˆä¸€è‡´çš„æ ·å¼ã€‚

1. å®‰è£…ä¾èµ–

``` bash
pnpm add -D @commitlint/cli @commitlint/config-conventional
echo "export default { extends: ['@commitlint/config-conventional'] };" > commitlint.config.js
```

2. é…åˆæäº¤é’©å­

åˆ›å»ºæäº¤é’©å­æ–‡ä»¶å¹¶æ·»åŠ å‘½ä»¤
``` bash
echo "pnpm dlx commitlint --edit \$1" > .husky/commit-msg
```

**æ³¨æ„ï¼š**
ä½¿ç”¨ä¸Šé¢å‘½ä»¤åˆ›å»ºå‡ºçš„æ–‡ä»¶æ ¼å¼ä¸ä¸ºUTF-8(åˆ é™¤åæ‰‹åŠ¨åˆ›å»º)

3. (å¯é€‰)ä½¿ç”¨æäº¤äº¤äº’å·¥å…·
[@commitlint/cz-commitlint](https://www.npmjs.com/package/@commitlint/cz-commitlint)
``` bash
pnpm add -D @commitlint/cz-commitlint commitizen inquirer@9
```
é…ç½®package.json
``` json
{
  "scripts": {
    "commit": "git-cz"
  },
  "config": {
    "commitizen": {
      "path": "@commitlint/cz-commitlint"
    }
  }
}
```

#### è¯¦ç»†é…ç½®æ–‡ä»¶

1. eslint
``` ts
import js from '@eslint/js';
import globals from 'globals';
// eslint-disable-next-line import/no-unresolved
import tseslint from 'typescript-eslint';
import pluginReact from 'eslint-plugin-react';
import reactHooks from 'eslint-plugin-react-hooks';
import reactRefresh from 'eslint-plugin-react-refresh';
import importPlugin from 'eslint-plugin-import';
// eslint-disable-next-line import/no-unresolved
import { defineConfig, globalIgnores } from 'eslint/config';
import eslintConfigPrettier from 'eslint-config-prettier/flat';

export default defineConfig([
  // å…¨å±€å¿½ç•¥ dist å’Œé…ç½®æ–‡ä»¶ç›®å½•
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,mjs,cjs,ts,mts,cts,jsx,tsx}'],
    plugins: { js },
    extends: ['js/recommended'],
    languageOptions: { globals: globals.browser },
  },
  importPlugin.flatConfigs.recommended,
  importPlugin.flatConfigs.typescript,
  tseslint.configs.recommended,
  pluginReact.configs.flat.recommended,
  reactHooks.configs.flat.recommended,
  reactRefresh.configs.vite,
  eslintConfigPrettier,
  // base
  {
    rules: {
      'no-console': 'error',
      'no-debugger': 'error',
      indent: ['error', 2],
    },
  },
  // react
  {
    rules: {
      // åŸºç¡€Reactè§„èŒƒ (eslint-plugin-react)
      'react/react-in-jsx-scope': 'off', // React 17+å¯å…³é—­
      'react/jsx-uses-vars': 'error',
      'react/no-deprecated': 'warn', // æ£€æµ‹åºŸå¼ƒAPIï¼ˆéœ€ç‰ˆæœ¬æ”¯æŒï¼‰

      // Hooksè§„èŒƒ (eslint-plugin-react-hooks)
      'react-hooks/rules-of-hooks': 'error', // å¿…é¡»è®¾ä¸ºerror
      'react-hooks/exhaustive-deps': 'warn', // ä¾èµ–æ£€æŸ¥è®¾ä¸ºwarn

      // çƒ­æ›´æ–°å…¼å®¹ (eslint-plugin-react-refresh)
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true }, // å…è®¸å¯¼å‡ºå¸¸é‡
      ],
    },
    settings: {
      react: {
        version: 'detect', // è‡ªåŠ¨ä»node_modules/reactè¯»å–ç‰ˆæœ¬
      },
    },
  },
  // import
  {
    rules: {
      // å…³é”®è§„åˆ™å¯ç”¨
      'import/no-unresolved': 'error', // è·¯å¾„å¿…é¡»æœ‰æ•ˆ
      'import/no-unused-modules': 'warn', // æœªä½¿ç”¨æ¨¡å—è­¦å‘Š
      'import/no-cycle': 'error', // ç¦æ­¢å¾ªç¯ä¾èµ–
      'import/order': [
        // å¯¼å…¥æ’åº
        'error',
        {
          groups: ['builtin', 'external', 'internal', 'parent', 'sibling'],
          'newlines-between': 'always',
        },
      ],
    },
    settings: {
      'import/resolver': {
        node: {
          extensions: ['.js', '.jsx', '.ts', '.tsx'], // æ”¯æŒViteæ–‡ä»¶ç±»å‹
        },
      },
    },
  },
]);

```

2. prettier
``` json
{
  "singleQuote": true
}
```
3. commitlint
``` js
export default {
  extends: ['@commitlint/config-conventional'],
};

```
4. husky
pre-commit

``` bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

commit-msg
``` bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

pnpm dlx commitlint --edit \
```

5. package.json
``` json
{
  "name": "inspector-mobile-web",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext .js,.jsx,.ts,.tsx",
    "format": "prettier --write \"src/**/*.{js,jsx,ts,tsx,css,md}\"",
    "prepare": "husky install",
    "commit": "git-cz"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "packageManager": "pnpm@10.20.0",
  "devDependencies": {
    "@commitlint/cli": "^20.2.0",
    "@commitlint/config-conventional": "^20.2.0",
    "@commitlint/cz-commitlint": "^20.2.0",
    "@eslint/css": "^0.14.1",
    "@eslint/js": "^9.39.2",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react-swc": "^4.2.2",
    "commitizen": "^4.3.1",
    "eslint": "^9.39.2",
    "eslint-config-prettier": "^10.1.8",
    "eslint-plugin-import": "^2.32.0",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.26",
    "globals": "^16.5.0",
    "inquirer": "^9.3.8",
    "jiti": "^2.6.1",
    "prettier": "3.7.4",
    "typescript": "^5.9.3",
    "typescript-eslint": "^8.50.0",
    "vite": "^7.3.0"
  },
  "dependencies": {
    "react": "^19.2.3",
    "react-dom": "^19.2.3"
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx}": "eslint --cache --fix",
    "*.{js,jsx,ts,tsx,css,md}": "prettier --write"
  },
  "config": {
    "commitizen": {
      "path": "@commitlint/cz-commitlint"
    }
  }
}

```

### å…¨å±€æ ·å¼

#### é¢„å¤„ç†å™¨SASS

1. ä½¿ç”¨sass

``` bash
pnpm add -D sass-embedded
```

2. åˆ›å»ºå…¨å±€æ ·å¼æ–‡ä»¶å¹¶åœ¨main.tsxå¼•å…¥

``` scss
// global.scss
@use './reset.scss';
```

**æ³¨æ„å¼•å…¥åtsç±»å‹æŠ¥é”™**

TypeScript æŠ¥é”™ "æ‰¾ä¸åˆ°æ¨¡å—â€œ./css/global.scssâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜"ï¼Œè¿™æ˜¯å› ä¸º TypeScript é»˜è®¤ä¸è¯†åˆ« .scss æ–‡ä»¶ç±»å‹ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ç±»å‹å£°æ˜æ–‡ä»¶æ¥å‘Šè¯‰ TypeScript å¦‚ä½•å¤„ç†è¿™äº›æ–‡ä»¶ã€‚

è§£å†³æ–¹å¼ï¼šåˆ›å»º SCSS ç±»å‹å£°æ˜æ–‡ä»¶ ï¼šåœ¨ src ç›®å½•ä¸‹åˆ›å»ºäº† styles.d.ts æ–‡ä»¶

``` ts
// styles.d.ts
declare module '*.scss' {
  const content: { [className: string]: string };
  export default content;
}
```

3. åˆ›å»ºå…¨å±€å˜é‡

``` scss
// variable.scss
$body-bg: #fff;
```
4. é…ç½®å…¨å±€ä½¿ç”¨å˜é‡

``` ts
// vite.config.ts
export default defineConfig({
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@use '@/css/variable.scss' as *;`,
      },
    },
  },
});
```

#### postcss é…ç½®

Viteå†…ç½®PostCSSæ”¯æŒï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚

#### px è½¬ vw

æ¨èä½¿ç”¨ `@minko-fe/postcss-pxtoviewport` æ’ä»¶

``` bash
pnpm add -D @minko-fe/postcss-pxtoviewport
```

é…ç½® postcss.config.js
``` js
// postcss.config.js
import pxtoviewport from '@minko-fe/postcss-pxtoviewport'
export default {
  plugins: [
    pxtoviewport({
      viewportWidth: 375,
      selectorBlackList: [],
      propList: ['*'],
      atRules: ['media'],
      // ...
    }),
  ],
}
```

### UIç»„ä»¶åº“

[é€‰ç”¨NutUI-Reactç»„ä»¶åº“](https://nutui.jd.com/h5/react/3x/#/zh-CN/guide/intro-react)

**æ³¨æ„ï¼š**
1. react ç‰ˆæœ¬éœ€è¦ä¸ NutUI-React ç»„ä»¶åº“ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼ˆå½“å‰ç‰ˆæœ¬ä¸º18.3.1ï¼‰ä¸èƒ½ä½¿ç”¨react19
2. æŒ‰éœ€å¼•å…¥ç»„ä»¶åº“æ ·å¼
   vitePluginImpç±»å‹æŠ¥é”™
   (vitePluginImp as unknown as (...args: unknown[]) => Plugin)
3. å¼•å…¥cssæ ·å¼tsç±»å‹æŠ¥é”™
   styles.d.ts
   ``` ts
    declare module '*.css' {
      const content: { [className: string]: string };
      export default content;
    }
   ```

### å…¨å±€çŠ¶æ€çŠ¶æ€

[react-redux](https://react-redux.js.org/introduction/getting-started)

``` bash
pnpm add @reduxjs/toolkit react-redux
```

### å…¨å±€è·¯ç”±é…ç½®

[react-router](https://reactrouter.com/start/declarative/installation)

``` bash
pnpm add react-router
```

ä½¿ç”¨dataæ¨¡å¼é…ç½®è·¯ç”±
1. å»ºç«‹è·¯ç”±è¡¨

``` ts
// router/index
import { lazy } from 'react'
import { createBrowserRouter } from 'react-router'

const Home = lazy(() => import('@/views/home/Home'))
const Events = lazy(() => import('@/views/events/Events'))

const router = createBrowserRouter([
  {
    path: '/',
    Component: Home,
  },
  {
    path: 'events',
    Component: Events,
  },
])

export default router
```
**æ³¨æ„ï¼š**

ä½¿ç”¨@è·¯å¾„åˆ«åéœ€è¦é…ç½®3ä¸ªåœ°æ–¹
1. tsconfig.base.json
``` json
{
  "baseUrl": ".",
  "paths": {
    "@/*": ["src/*"]
  }
}
```

2. vite.config.ts
``` ts
// vite.config.ts
export default defineConfig({
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
})
```

3. eslint.config.ts
ESLintçš„ eslint-plugin-import æ’ä»¶è¿˜éœ€è¦é¢å¤–é…ç½®æ‰èƒ½è¯†åˆ«TypeScriptçš„è·¯å¾„åˆ«åã€‚

``` bash
pnpm add -D eslint-import-resolver-typescript
```

``` ts
// eslint.config.ts
settings: {
  'import/resolver': {
    'typescript': {},
    node: {
      extensions: ['.js', '.jsx', '.ts', '.tsx'], // æ”¯æŒViteæ–‡ä»¶ç±»å‹
    },
  },
},
```

2. é…ç½®è·¯ç”±
``` tsx
// app.tsx
import router from './router'
import { RouterProvider } from 'react-router/dom'

function App() {
  return (
    <RouterProvider router={router} />
  )
}
```

3. è·¯ç”±æƒé™é…ç½®

ä½¿ç”¨middleware

``` ts
// router / index.ts
import store from '@/store';
import events from '@/utils/event';
import { getItem } from '@/utils/storage';

const Home = lazy(() => import('@/views/home/Home'));

const authMiddleware = async (
  { request }: { request: Request },
  next: () => void,
) => {
  const url = new URL(request.url);
  const state = store.getState();
  const user = state.user.user;

  const baseUrl = import.meta.env?.BASE_URL;

  const { pathname } = url || {};
  const curPath = pathname.split(baseUrl)[1];
  const token = getItem('token');
  if (curPath !== '/login' && !token) {
    return events.emit(NOT_AUTHOR);
  }

  if (!user && curPath !== '/login') {
    events.emit(SET_USER);
  }

  await next();
};

const routerArr = [
  {
    path: '/',
    Component: Home,
  }
]

const router = createBrowserRouter(
  [
    ...routerArr.map((item) => ({
      ...item,
      middleware: [authMiddleware],
    })),
  ],
  {
    basename: import.meta.env?.BASE_URL,
  },
)

events.on(NOT_AUTHOR, () => {
  router.navigate('/login', {
    replace: true,
  });
});
```

``` ts
// store/index
events.on(SET_USER, () => {
  store.dispatch(postUserInfo());
});

// store/slices/user
export const postUserInfo = createAsyncThunk('posts/getUser', async () => {
  const res = await getUserInfo();
  return res;
});

export const userSlice = createSlice({
  name: 'user',
  initialState,
  reducers: {
    setUser: (state: UserState, action: PayloadAction<IUser | null>) => {
      const { payload } = action;
      state.user = payload;
    },
  },
  extraReducers(builder) {
    builder.addCase(postUserInfo.fulfilled, (state, action) => {
      state.user = action.payload;
    });
  },
});
```

**eventsäº‹ä»¶ä¸­å¿ƒ: å•ç‹¬å¤„ç†è·¯ç”±/storeç­‰æ¨¡å—é€»è¾‘ï¼Œä¿æŒå„æ¨¡å—çº¯ç²¹**

``` ts
type TEvent = () => void;
class EventBus {
  #events: Map<string, Set<TEvent>>;
  private static instance: EventBus;

  constructor() {
    this.#events = new Map();
  }

  public emit(key: string) {
    const curEvent = this.#events.get(key);
    if (curEvent) {
      curEvent.forEach((fn: TEvent) => fn?.());
    }
  }

  public on(key: string, callback: TEvent) {
    const curEvent = this.#events.get(key);
    if (curEvent) {
      curEvent.add(callback);
    } else {
      const set = new Set<TEvent>();
      set.add(callback);
      this.#events.set(key, set);
    }
  }

  public static getInstance() {
    if (!EventBus.instance) {
      EventBus.instance = new EventBus();
    }
    return EventBus.instance;
  }

  clear() {
    this.#events.clear();
  }
}

const events = EventBus.getInstance();
export default events;

```


**æŒ‰é’®æƒé™è‡ªå®šä¹‰Hooks**

``` ts
import { useAppSelector } from '@/store/hooks';
import { selectUser } from '@/store/slices/userSlices';

export default function usePermission() {
  const user = useAppSelector(selectUser);

  const hasPermission = (permission: string) => {
    const { isAdmin, permissionList = [] } = user || {};
    if (isAdmin) return true;
    return permissionList.includes(permission as unknown as string);
  };

  return {
    hasPermission,
  };
}
```

### è¯·æ±‚ç›¸å…³å°è£…

``` bash
pnpm add axios ahooks

```

1. å°è£…axios
``` ts
import axios from "axios";
import type { AxiosInstance, AxiosRequestConfig } from "axios";

class Axios {
  instance: AxiosInstance;
  config: AxiosRequestConfig;
  constructor(config: AxiosRequestConfig) {
    this.config = config;
    this.instance = this.init();
  }

  init () {
    return axios.create({
      baseURL: import.meta.env?.VITE_AXIOS_BASE_URL,
      timeout: 60000,
      ...this.config,
    })
  }

  request<T> (config: AxiosRequestConfig) {
    return this.instance.request({
      ...config,
    }) as Promise<T>
  }

  get<T> (url: string, options = { }) {
    return this.request<T>({
      method: 'GET',
      url,
      ...options,
    })
  }

  post<T> (url: string, data?: unknown, options = {}) {
    return this.request<T>({
      method: 'POST',
      url,
      data,
      ...options,
    })
  }

  delete<T> (url: string, options = { }) {
    return this.request<T>({
      method: 'DELETE',
      url,
      ...options,
    })
  }

  put<T> (url: string, data?: unknown, options = { }) {
    return this.request<T>({
      method: 'PUT',
      url,
      data,
      ...options,
    })
  }
}

export default Axios;
```

**æ³¨æ„ï¼š**
`import.meta.env?.VITE_AXIOS_BASE_URL`tsç±»å‹æŠ¥é”™ï¼ˆç±»å‹â€œImportMetaâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œenvâ€ï¼‰
è§£å†³æ–¹æ³•ï¼šsrc/vite.d.ts

``` ts
/**
 * è¿™æ˜¯ä¸€ä¸ª TypeScript çš„ä¸‰æ–œçº¿æŒ‡ä»¤ï¼ˆtriple-slash directiveï¼‰ï¼Œç”¨äºå‘Šè¯‰ TypeScript ç¼–è¯‘å™¨ï¼š

"è¯·åŒ…å« vite/client çš„ç±»å‹å®šä¹‰"

"è¿™äº›ç±»å‹å®šä¹‰æ¥è‡ªäº @types/vite/client åŒ…"
*/
/**
 * å½“ TypeScript çœ‹åˆ°è¿™ä¸ªæŒ‡ä»¤æ—¶ï¼Œå®ƒä¼šï¼š

æŸ¥æ‰¾ node_modules/@types/vite/client.d.ts

æˆ–è€…æŸ¥æ‰¾ node_modules/vite/client.d.tsï¼ˆå¦‚æœ Vite åŒ…è‡ªå¸¦ç±»å‹ï¼‰
*/
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_AXIOS_BASE_URL: string
  // æ›´å¤šç¯å¢ƒå˜é‡...
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}
```

2. å°è£…è¯·æ±‚
``` ts
import Axios from './axios';
import { getItem } from './storage';
import events from './event';
import { NOT_AUTHOR } from './const';

const http = new Axios({});

http.instance.interceptors.request.use(
  (config) => {
    const token = getItem('token');
    if (token) {
      config.headers.Authorization = `${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  },
);

http.instance.interceptors.response.use(
  (response) => {
    const { data } = response

    const { status, message, data: lastData } = data || {}

    if (status !== 200) {
      return Promise.reject(new Error(message))
    }
    return lastData;
  },
  (error) => {
    // æ·»åŠ 401å¤„ç† eventså®ç°å‚è€ƒè·¯ç”±æƒé™æ¿å—
    const { status } = error || {};
    if (status === 401) {
      events.emit(NOT_AUTHOR);
      return Promise.resolve();
    }
    return Promise.reject(error);
  },
);

export default http;

```

3. å°è£…toast
``` ts
import { Toast } from '@nutui/nutui-react';

let hasLoadingToast = false;

const toastConfig = {
  // 2s
  duration: 2,
};

export const toast = (message: string) => {
  Toast.show({
    content: message,
    ...toastConfig,
  });
};

export const successToast = (message: string) => {
  Toast.show({
    content: message,
    icon: 'success',
    ...toastConfig,
  });
};

export const errorToast = (message: string) => {
  Toast.show({
    content: message,
    icon: 'fail',
    ...toastConfig,
  });
};

export const loadingToast = (message: string) => {
  // å¤„ç†å¤šä¸ªtoastå åŠ é—®é¢˜
  if (hasLoadingToast) return;
  hasLoadingToast = true;
  Toast.show({
    content: message,
    icon: 'loading',
    duration: 0,
  });
};

export const clearLoadingToast = () => {
  Toast?.clear();
  hasLoadingToast = false;
};

```

4. å°è£…useFetch
``` ts
import { useState, useEffect } from 'react';
import type { AxiosError } from 'axios';

import { clearLoadingToast, loadingToast, errorToast } from '@/utils/toast';
import type { TApi, TCallback } from '@/typings/index';

/**
 * å°è£…è¯·æ±‚
 * @param service è¯·æ±‚api
 * @param init resåˆå§‹å€¼
 * @param options è¯·æ±‚é€‰é¡¹
 */
export interface IUseFetchOptions {
  // é»˜è®¤è¯·æ±‚å‚æ•°
  defaultParams?: unknown;
  // æ˜¯å¦æ‰‹åŠ¨æ‰§è¡Œ
  manual?: boolean;
  // æ˜¯å¦éœ€è¦åŠ è½½ä¸­
  needLoading?: boolean;
  // è¯·æ±‚æˆåŠŸæ‰§è¡Œçš„å›è°ƒ
  onSuccess?: TCallback;
  // è¯·æ±‚å¤±è´¥æ‰§è¡Œçš„å›è°ƒ
  onError?: TCallback;
  // è¯·æ±‚å®Œæˆæ‰§è¡Œçš„å›è°ƒ
  onComplete?: TCallback;
}

export default function useFetch<T>(
  service: TApi,
  init?: T,
  options?: IUseFetchOptions,
) {
  const {
    defaultParams,
    manual = false,
    // nutUI è‡ªå¸¦çš„toastå¤šä¸ªå åŠ åä¸ä¼šå…¨éƒ¨æ¸…é™¤ ===
    needLoading = true,
    onSuccess,
    onError,
    onComplete,
  } = options || {};

  const [loading, setLoading] = useState(false);
  const [completed, setCompleted] = useState(false);
  const [data, setData] = useState<T | undefined>(init ?? undefined);

  const changeLoading = (newLoading: boolean) => {
    setLoading(newLoading);
  };

  function isObj(obj: unknown): boolean {
    return (
      typeof obj === 'object' &&
      obj !== null &&
      Object.prototype.toString.call(obj) === '[object Object]'
    );
  }

  function isFunc(func: unknown): boolean {
    return typeof func === 'function';
  }

  // å¤„ç†è¯·æ±‚å‚æ•°
  function dealParams(newParams?: unknown, query?: unknown) {
    if (!newParams && !query) {
      return;
    }

    if (newParams) {
      const paramsVal = newParams;
      if (query) {
        const queryVal = query;
        if (isObj(paramsVal) && isObj(queryVal)) {
          return {
            ...paramsVal,
            ...queryVal,
          };
        }
        return queryVal;
      }
      return paramsVal;
    }

    if (query) {
      return query;
    }
  }

  /*
   * @param query è¯·æ±‚å‚æ•°
   **/
  async function execute<R>(query?: R) {
    try {
      changeLoading(true);
      if (needLoading) {
        loadingToast(' ');
      }
      const postData = dealParams(defaultParams, query);
      const result = await service(postData);
      const dealData =
        onSuccess && isFunc(onSuccess) ? onSuccess(result: T) : result;
      setData(dealData as unknown as T);
    } catch (e: unknown) {
      errorToast(
        (e as unknown as AxiosError)?.message ?? 'ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•',
      );
      if (onError && isFunc(onError)) {
        onError(e);
      }
    } finally {
      changeLoading(false);
      if (needLoading) {
        clearLoadingToast();
      }
      if (onComplete && isFunc(onComplete)) {
        onComplete();
      }
      setCompleted(true);
    }
  }

  useEffect(() => {
    if (!manual) {
      execute();
    }
    return () => {
      setData(init ?? undefined);
      setLoading(false);
      setCompleted(false);
    };
  }, []);

  return {
    data,
    loading,
    completed,
    execute,
  };
}

```

5. å°è£…storage
``` ts
export const setItem = (key: string, value: string) => {
  localStorage.setItem(key, value);
};

export const getItem = (key: string) => {
  return localStorage.getItem(key);
};

export const removeItem = (key: string) => {
  localStorage.removeItem(key);
};

```

6. ä½¿ç”¨
api
``` ts
import fetch from '@/utils/fetch'

export interface IViewMatterStatusRes {
  ids?: string;
  number?: number;
  type?: string;
}

export type TViewMatterStatusRes = IViewMatterStatusRes[]

export const getAllViewMatterStatus = (year: number) => {
  return fetch.post<TViewMatterStatusRes>('/viewMatterStatus/getAllViewMatterStatus', {
    query: {
      year,
    }
  })
}
```

ç»„ä»¶ä½¿ç”¨
``` tsx
import useFetch from './hooks/useFetch';
import { getAllViewMatterStatus } from './apis/home';

const App = () => {

  const { data, loading } = useFetch(getAllViewMatterStatus);

  return (
    <div className="app">
    </div>
  );
};

export default App;

```

## å…¬å…±ç»„ä»¶å°è£…

### InfiniteLoading

**æ³¨æ„ï¼š**

1. åˆ·æ–°åé‡ç½® hasMore / loaded / loading init
2. åˆ‡æ¢tabåå°†ulçš„scrollTopåˆå§‹åŒ–
3. ulé«˜åº¦éœ€è¦å‡å»margin

``` tsx
import {
  useState,
  useEffect,
  type CSSProperties,
  type ReactNode,
  useRef,
} from 'react';
import { InfiniteLoading } from '@nutui/nutui-react';
import type { AxiosError } from 'axios';
import { Refresh } from '@nutui/icons-react';

import { clearLoadingToast, errorToast, loadingToast } from '@/utils/toast';
import CEmpty from '@/components/empty/CEmpty';

import type { TApi, TRecord } from '@/typings';

const InfiniteUlStyle: CSSProperties = {
  width: '100%',
  // æ³¨æ„é«˜åº¦è¦å‡å»ä¸Šä¸‹margin
  height: 'calc(100vh - 88px - 30px)',
  padding: '0 15px',
  overflowY: 'auto',
  overflowX: 'hidden',
};

const CInfiniteLoading = (props: {
  api: TApi;
  query: TRecord;
  children?: (...args: unknown[]) => ReactNode;
}) => {
  const { api, query, children } = props;

  const infiniteUlRef = useRef<HTMLUListElement>(null);

  const [refreshList, setRefreshList] = useState([]);
  const [refreshHasMore, setRefreshHasMore] = useState(true);

  // æ˜¯å¦åŠ è½½å®Œæˆ
  const [loaded, setLoaded] = useState(false);

  const [page, setPage] = useState(1);

  const pageSize = 10;

  const init = () => {
    // åˆå§‹æ»šåŠ¨æ¡
    if (infiniteUlRef?.current?.scrollTop) {
      infiniteUlRef.current.scrollTop = 0;
    }
    refreshLoadMore();
  };

  const parseQuery = (obj: TRecord) => {
    const newObj: TRecord = {};
    Object.keys(obj).forEach((key: string) => {
      newObj[key] = obj[key] || undefined;
    });
    return newObj;
  };

  const refreshLoadMore = async (type = 'refresh') => {
    // å¤„ç†é¦–æ¬¡æ›´æ–°é‡ç½®page
    let currentPage = page;
    if (type === 'refresh' && page > 1) {
      currentPage = 1;
    }
    // åˆ·æ–°æ—¶é‡ç½® hasMore / loaded / loading init
    if (type === 'refresh') {
      setRefreshHasMore(true);
      loadingToast(' ');
      setLoaded(false);
    }

    try {
      const postData = {
        currentPage: currentPage,
        pageSize,
        query: parseQuery(query),
      };
      const res = await api(postData);

      const { totalCount, data } = res;

      const newList = type === 'refresh' ? data : [...refreshList, ...data];

      setRefreshList(newList);

      if (newList?.length >= totalCount) {
        setRefreshHasMore(false);
      } else {
        setPage(currentPage + 1);
      }
    } catch (e: unknown) {
      errorToast(
        (e as unknown as AxiosError)?.message ?? 'ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•',
      );
    } finally {
      if (type === 'refresh') {
        setLoaded(true);
        clearLoadingToast();
      }
    }
  };

  const refresh = async () => {
    setPage(1);
    init();
  };

  useEffect(() => {
    init();
  }, [query]);

  // æ²¡æœ‰æ•°æ®æ—¶ä¸æ˜¾ç¤º
  const loadMoreText = refreshList?.length > 0 ? 'æ²¡æœ‰æ›´å¤šäº†' : ' ';

  return (
    <ul id="refreshScroll" ref={infiniteUlRef} style={InfiniteUlStyle}>
      <InfiniteLoading
        pullingText={
          <>
            <Refresh className="nut-icon-am-rotate nut-icon-am-infinite" />
          </>
        }
        loadingText={
          <>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              className="nut-infinite-bottom-tips-icons"
            >
              <circle cx="2" cy="12" r="2" fill="#818181" />
              <circle cx="12" cy="12" r="2" fill="#818181" />
              <circle cx="22" cy="12" r="2" fill="#818181" />
            </svg>
            åŠ è½½ä¸­
          </>
        }
        target="refreshScroll"
        pullRefresh
        hasMore={refreshHasMore}
        onLoadMore={() => refreshLoadMore('load')}
        onRefresh={refresh}
        loadMoreText={loadMoreText}
      >
        {
          refreshList.length === 0 && loaded ? <CEmpty /> : ''
        }
        {refreshList.map((item, index) => {
          return (
            <li className="infiniteLi" key={index}>
              {children?.(item)}
            </li>
          );
        })}
      </InfiniteLoading>
    </ul>
  );
};
export default CInfiniteLoading;

```

ä½¿ç”¨ï¼š
``` tsx
<CInfiniteLoading
  api={getUnitMatterByPage}
  query={query}
>
  {(item) => <MatterItem item={item as unknown as IMatterByPageRes} />}
</CInfiniteLoading>
```

## æ„å»ºäº§ç‰©ä¼˜åŒ–

ä½¿ç”¨äº§ç‰©åˆ†æå·¥å…·ï¼Œå…ˆåˆ†æå„æ¨¡å—çš„å¤§å°ï¼Œé’ˆå¯¹ç‰¹å®šé—®é¢˜è¿›è¡Œä¼˜åŒ–

``` ts
import { resolve } from 'path';

import { defineConfig, type Plugin } from 'vite';
import react from '@vitejs/plugin-react-swc';
import vitePluginImp from 'vite-plugin-imp';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  base: '/inspector-mobile',
  plugins: [
    react(),
    (vitePluginImp as unknown as (...args: unknown[]) => Plugin)({
      libList: [
        {
          libName: '@nutui/nutui-react',
          style: (name: string) => {
            // é»˜è®¤ä¸»é¢˜
            // æŒ‰éœ€å¼•å…¥ css æ–‡ä»¶çš„å¤„ç†ï¼Œä¸¤ç§æ–¹å¼æ‹©å…¶ä¸€
            return `@nutui/nutui-react/dist/es/packages/${name.toLowerCase()}/style/css`;
          },
          replaceOldImport: false,
          camel2DashComponentName: false,
        },
      ],
    }),
    // åŒ…åˆ†æ
    visualizer({
      open: false,
      filename: 'dist/stats.html',
      gzipSize: true,
      brotliSize: true,
    }),
  ],
  resolve: {
    // é¿å…å¤šä»½ React å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯
    //dedupe: ['react', 'react-dom'],
    alias: {
      // å¼ºåˆ¶æ‰€æœ‰Reactå¼•ç”¨æŒ‡å‘åŒä¸€ä½ç½®
      // react: resolve(__dirname, 'node_modules/react'),
      // 'react-dom': resolve(__dirname, 'node_modules/react-dom'),
      '@': resolve(__dirname, './src'),
    },
  },
  // ç¡®ä¿é¢„æ„å»ºåŒ…å« Reactï¼Œå‡å°‘è¿è¡Œæ—¶ä¸ä¸€è‡´é£é™©
  // optimizeDeps: {
  //   include: ['react', 'react-dom'],
  //   force: true,
  // },
  build: {
    rollupOptions: {
      output: {
        // å°†reactå•ç‹¬åˆ†å‰²ä¸ºä¸€ä¸ªchunkåï¼Œpnpm previewé¢„è§ˆæŠ¥é”™å¦‚ä¸‹ï¼ˆæš‚æœªæ‰¾åˆ°è§£å†³æ–¹æ³•ï¼Œç›®å‰å°†reactCoreæ”¾å…¥å…¬å…±chunkï¼‰
        /**
         * Uncaught TypeError: Cannot set properties of undefined (setting 'Children')
        */
        manualChunks: createOptimizedChunks(),
        // æ–‡ä»¶å‘½åè§„åˆ™ï¼ˆçŸ­hashåˆ©äºç¼“å­˜ï¼‰
        chunkFileNames: 'js/[name]-[hash:8].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: 'assets/[name]-[hash:8][extname]',
      },
    },
  },
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@use '@nutui/nutui-react/dist/styles/variables.scss' as *; @use '@/assets/css/variable.scss' as *;`,
      },
    },
  },
  server: {
    port: 7777,
    host: true,
    proxy: {
      '/supervision-api': {
        // local ip change
        target: 'http://192.168.110.60:8092/dflc/supervising',
        // testing
        // target: 'http://1.14.33.174/supervision-api',
        changeOrigin: true,
        secure: false,
        rewrite: (path) => path.replace(/^\/supervision-api/, ''),
      },
    },
  },
});

function createOptimizedChunks() {
  const groups = {
    // reactCoreVendor: ['react', 'react-dom'],
    reactRouterVendor: ['react-router-dom', 'react-router'],
    reactOtherVendor: ['react-redux', '@reduxjs/toolkit'],
    uiVendor: ['@nutui/nutui-react', '@nutui/icons-react'],
    utilsVendor: ['axios', 'dayjs', 'ahooks'],
  };

  return (id: string) => {
    if (id.includes('node_modules')) {
      for (const [name, libs] of Object.entries(groups)) {
        if (
          libs.some((lib) =>
            id.includes(`/node_modules/${lib}/`) || id.includes(`/node_modules/${lib}.`)
          )
        ) {
          return `vendor-${name}`;
        }
      }

      // å…¶ä»–ä¾èµ–å½’å…¬å…±åŒ…
      return 'vendor-common';
    }

    // ä¸šåŠ¡ä»£ç æŒ‰ç›®å½•è‡ªåŠ¨åˆ†å—ï¼ˆé¿å…å•æ–‡ä»¶è¿‡å¤§ï¼‰
    if (id.includes('/src/views/')) {
      // eslint-disable-next-line no-useless-escape
      const match = id.match(/\/src\/(views)\/([^\/]+)/);
      if (match) return `chunk-${match[2]}`;
    }
  };
}

```

## é‡åˆ°é—®é¢˜

1. tså¼€å¯erasableSyntaxOnlyï¼ˆæ ‡å¿—ä¼šä½¿ TypeScript åœ¨é‡åˆ°å¤§å¤šæ•°å…·æœ‰è¿è¡Œæ—¶è¡Œä¸ºçš„ TypeScript ç‰¹å®šç»“æ„æ—¶æŠ¥é”™ï¼‰åå®šä¹‰enumæŠ¥é”™
è§£å†³æ–¹æ³•ï¼š

``` ts
// æŠ¥é”™ä»£ç 
export enum EMatterStatus = {
  ALL,
  NORMAL,
  TIMEOUT,
}
// ä¿®æ”¹åçš„ä»£ç 
// `enum` åœ¨å¯ç”¨ `erasableSyntaxOnly` æ—¶ä¸å¯ç”¨ï¼Œä½¿ç”¨è¿è¡Œæ—¶å¸¸é‡å¯¹è±¡ + ç±»å‹åˆ«åæ›¿ä»£
export const EMatterStatus = {
  ALL: 0,
  NORMAL: 1,
  TIMEOUT: 2,
  COMPLETE: 3,
  NOTSIGN: 4,
  YELLOWCARD: 5,
  REDCARD: 6,
} as const;

export type EMatterStatus = (typeof EMatterStatus)[keyof typeof EMatterStatus];
```

2. reactä¸­ä¸€ä¸ªstateæ”¹å˜åéœ€è¦ä¿®æ”¹å¦ä¸€ä¸ªstateï¼ŒæŠ¥é”™

æŠ¥é”™ä»£ç ï¼š
``` ts
const [state, setState] = useState(0)
const [newState, setNewState] = useState(1)

effect(() => {
  setNewState(state)
}, [state])

```

è§£å†³ï¼š

``` ts
const [newState, setNewState] = useState(1)

const state = newState

const changeState = (s) => {
  setNewState(s)
}
```

3. tagå’Œæ–‡æœ¬å‚ç›´å±…ä¸­ï¼Œå°†æ–‡æœ¬æ”¾åœ¨spanä¸­è®¾ç½®æ ·å¼verticalAlign: middle
4. ä½¿ç”¨reactRouterV7è·¯ç”±è·³è½¬ä¼ å‚æ—¶ä¸€å®šè¦ç»™é»˜è®¤å€¼ï¼Œä¸è¦å‚æ•°ä¸ä¼šæ”¹å˜
``` ts
import { useNavigate } from 'react-router'

const navigate = useNavigate()

function navigateTo (id = 0) {
  navigate(`/test/${id}`)
}
```
5. nutuiçš„toastç»„ä»¶å¤šä¸ªä¸€èµ·å¼¹å‡ºåªä¼šæ¸…ç©ºæœ€åä¸€ä¸ª
è§£å†³æ–¹æ³•ï¼šæ·»åŠ å¼¹æ¡†æ ‡è®°ï¼Œæœ‰å¼¹æ¡†æ—¶ä¸å†å¼¹å‡ºã€‚ï¼ˆæŸ¥çœ‹äº†æºç ï¼Œæ­£åœ¨æ€è€ƒè§£å†³æºå¤´é—®é¢˜ï¼‰

